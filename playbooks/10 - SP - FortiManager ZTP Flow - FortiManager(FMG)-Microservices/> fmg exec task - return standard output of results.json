{
    "@type": "Workflow",
    "triggerLimit": null,
    "name": "> fmg exec task - return standard output of results",
    "aliasName": null,
    "tag": null,
    "description": null,
    "isActive": true,
    "debug": false,
    "singleRecordExecution": false,
    "remoteExecutableFlag": false,
    "parameters": [
        "connector_config",
        "exec_url",
        "exec_payload"
    ],
    "synchronous": false,
    "collection": "\/api\/3\/workflow_collections\/acff9572-b869-4ceb-bbc1-1c3700ec9a4e",
    "versions": [],
    "triggerStep": "\/api\/3\/workflow_steps\/a8e3a739-2f6b-4f3f-837f-b1b08ffb8858",
    "steps": [
        {
            "@type": "WorkflowStep",
            "name": "analyze task data",
            "description": null,
            "arguments": {
                "task_data_parsed": "{%- macro format_seconds(seconds) -%}\n    {%- set hours = seconds \/\/ 3600 -%}\n    {%- set minutes = (seconds % 3600) \/\/ 60 -%}\n    {%- set remaining_seconds = seconds % 60 -%}\n    {{ hours }}h {{ minutes }}m {{ remaining_seconds }}s\n{%- endmacro -%}\n{%- set empty = ['',Null,None] -%}\n{%- set exec_results = vars.task_data -%}\n{%- set results = {} -%}\n\n{# set the default structure for the return #}\n{%- set _do = results.update( {\n  \"error\":True,\n  \"task_id\":'',\n  \"task_data\":{},\n  \"task_time\": {\n    \"total_seconds\":\"\",\n    \"total_time\":\"\"\n  },\n  \"msg\":\"Task data is empty.\"\n} ) -%}\n\n{%- if exec_results.execute_response.task is defined  -%}\n    {%- set _do = results.update( {\"task_id\":exec_results.execute_response.task} ) -%}\n{%- endif -%}\n\n{%- if exec_results.status is defined \n      and exec_results.task_response is defined \n      and exec_results.task_response|length > 1 -%}\n\n  {# If we look to have task status and task response data we can parse it. #}\n  {%- set _do = results.update( {\"task_data\":exec_results.task_response} ) -%}\n  {%- set start_time = exec_results.task_response.start_tm -%}\n  {%- set end_time = exec_results.task_response.end_tm -%}\n  {%- if end_time == 0 -%}\n    {%- set end_time = arrow.utcnow().int_timestamp -%}\n  {%- endif -%}\n  {%- set total_seconds = end_time-start_time -%}\n  {%- set _do = results.update( { \n                        \"task_time\": {\n                          \"total_seconds\":end_time-start_time,\n                          \"total_time\":format_seconds(total_seconds)\n                       } \n    } ) -%}\n  {%- set line_cnt = 0 -%}  \n  {%- if exec_results.task_response.line not in empty -%}\n    {%- set line_cnt = exec_results.task_response.line|length -%}\n  {%- endif -%}\n  {%- if exec_results.status == 0 -%}\n    {%- set _do = results.update( {\"error\":False} ) -%}\n    {%- set msg = exec_results.task_response.title \n                         + \" ( \" + exec_results.task_response.state|default(\"unknown\") + \" ) \"\n                         + \" -- \" \n                         + exec_results.task_response.line[line_cnt-1].name|default(\"\")\n                         + \" \"\n                         + exec_results.task_response.line[line_cnt-1].detail|default(\"\") -%}\n    {%- set _do = results.update( {\"msg\":msg}) -%}\n    {%- if \"error\" in exec_results.task_response.state -%}\n      {%- set _do = results.update( {\"error\":True} ) -%}\n    {%- endif -%}\n  {%- else -%}\n    {%- set msg = results.msg -%}\n    {%- if exec_results.task_response.msg is defined -%}\n      {%- set msg = exec_results.task_response.msg -%}\n      {%- if line_cnt > 0 -%}\n        {%- set msg = msg \n                           + \" -- \" \n                           + exec_results.task_response.line[line_cnt-1].name|default(\"\")\n                           + \" \"\n                           + exec_results.task_response.line[line_cnt-1].detail|default(\"\") -%}\n      {%- endif -%}\n    {%- endif -%}\n    {%- set _do = results.update( {\"msg\":msg}) -%}\n  {%- endif -%}\n\n{%- else -%}\n  {%- if exec_results.task_response.msg is defined -%}\n    {%- set _do = results.update( {\"msg\":exec_results.task_response.msg}) -%}\n {%- endif -%}\n{%- endif -%}\n{{results}}"
            },
            "status": null,
            "top": "160",
            "left": "380",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "f4e6309b-0f81-4b01-bc40-f8e6da79376e"
        },
        {
            "@type": "WorkflowStep",
            "name": "exec task",
            "description": null,
            "arguments": {
                "name": "Fortinet FortiManager JSON-RPC",
                "config": "{{vars.connector_config}}",
                "params": {
                    "url": "{{vars.exec_url}}",
                    "data": "{{vars.exec_payload}}",
                    "track_task": "{{vars.track_task_flag}}"
                },
                "version": "1.0.5",
                "connector": "fortinet-fortimanager-json-rpc",
                "operation": "json_rpc_execute",
                "operationTitle": "JSON RPC Exec",
                "pickFromTenant": false,
                "step_variables": []
            },
            "status": null,
            "top": "40",
            "left": "700",
            "stepType": "\/api\/3\/workflow_step_types\/0bfed618-0316-11e7-93ae-92361f002671",
            "group": null,
            "uuid": "6336fe80-38f2-466e-bbba-443b0e206fe8"
        },
        {
            "@type": "WorkflowStep",
            "name": "exec task data",
            "description": null,
            "arguments": {
                "exec_task_data": "{{vars.steps.exec_task}}"
            },
            "status": null,
            "top": "100",
            "left": "1060",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "2983819a-6077-483e-bc02-9e90d9056182"
        },
        {
            "@type": "WorkflowStep",
            "name": "return",
            "description": null,
            "arguments": {
                "output": "{{vars.task_data_parsed}}"
            },
            "status": null,
            "top": "160",
            "left": "40",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "4a3ed093-a2db-40a5-9246-74fdc64a3587"
        },
        {
            "@type": "WorkflowStep",
            "name": "setup env",
            "description": null,
            "arguments": {
                "exec_url": "{{vars.input.params['exec_url']}}",
                "exec_payload": "{{vars.input.params['exec_payload']}}",
                "track_task_flag": "true",
                "connector_config": "{{vars.input.params['connector_config']}}"
            },
            "status": null,
            "top": "40",
            "left": "380",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "7b81d764-12dd-4dbf-9fb2-101b6056cfa2"
        },
        {
            "@type": "WorkflowStep",
            "name": "Start",
            "description": null,
            "arguments": {
                "__triggerLimit": true,
                "step_variables": {
                    "input": {
                        "params": []
                    }
                },
                "triggerOnSource": true,
                "triggerOnReplicate": false
            },
            "status": null,
            "top": "40",
            "left": "40",
            "stepType": "\/api\/3\/workflow_step_types\/b348f017-9a94-471f-87f8-ce88b6a7ad62",
            "group": null,
            "uuid": "a8e3a739-2f6b-4f3f-837f-b1b08ffb8858"
        },
        {
            "@type": "WorkflowStep",
            "name": "task data from tracked task",
            "description": null,
            "arguments": {
                "task_data": "{{vars.steps.exec_task.data}}"
            },
            "status": null,
            "top": "160",
            "left": "700",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "aa89181a-83f6-43a3-8ed0-11f028fc0f8e"
        }
    ],
    "routes": [
        {
            "@type": "WorkflowRoute",
            "name": "analyze task data -> return",
            "targetStep": "\/api\/3\/workflow_steps\/4a3ed093-a2db-40a5-9246-74fdc64a3587",
            "sourceStep": "\/api\/3\/workflow_steps\/f4e6309b-0f81-4b01-bc40-f8e6da79376e",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "34215ef1-bdb8-4962-9278-d9980267c399"
        },
        {
            "@type": "WorkflowRoute",
            "name": "exec task data -> task data from tracked task",
            "targetStep": "\/api\/3\/workflow_steps\/aa89181a-83f6-43a3-8ed0-11f028fc0f8e",
            "sourceStep": "\/api\/3\/workflow_steps\/2983819a-6077-483e-bc02-9e90d9056182",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "8693459c-64b5-489f-b0cd-75c0a7f459eb"
        },
        {
            "@type": "WorkflowRoute",
            "name": "install_config -> run task data",
            "targetStep": "\/api\/3\/workflow_steps\/2983819a-6077-483e-bc02-9e90d9056182",
            "sourceStep": "\/api\/3\/workflow_steps\/6336fe80-38f2-466e-bbba-443b0e206fe8",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "84525b65-64d6-4752-9076-c633e75f3a16"
        },
        {
            "@type": "WorkflowRoute",
            "name": "setup env -> install_config",
            "targetStep": "\/api\/3\/workflow_steps\/6336fe80-38f2-466e-bbba-443b0e206fe8",
            "sourceStep": "\/api\/3\/workflow_steps\/7b81d764-12dd-4dbf-9fb2-101b6056cfa2",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "aab5563f-2a9c-41be-afbe-582c471b2254"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Start -> setup env",
            "targetStep": "\/api\/3\/workflow_steps\/7b81d764-12dd-4dbf-9fb2-101b6056cfa2",
            "sourceStep": "\/api\/3\/workflow_steps\/a8e3a739-2f6b-4f3f-837f-b1b08ffb8858",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "edbac54e-7036-464b-9f6a-fb8429ec11f2"
        },
        {
            "@type": "WorkflowRoute",
            "name": "task data from tracked task -> return",
            "targetStep": "\/api\/3\/workflow_steps\/f4e6309b-0f81-4b01-bc40-f8e6da79376e",
            "sourceStep": "\/api\/3\/workflow_steps\/aa89181a-83f6-43a3-8ed0-11f028fc0f8e",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "e0363696-73a2-4641-ab5f-b4391630762f"
        }
    ],
    "groups": [],
    "priority": "\/api\/3\/picklists\/2b563c61-ae2c-41c0-a85a-c9709585e3f2",
    "uuid": "68950ca9-cb82-442b-a8fd-6941308d9cee",
    "owners": [],
    "isPrivate": false,
    "deletedAt": null,
    "recordTags": [
        "connector_config",
        "exec_payload",
        "exec_url",
        "Subroutine"
    ]
}