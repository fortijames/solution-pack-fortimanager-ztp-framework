{
    "@type": "Workflow",
    "triggerLimit": null,
    "name": "On ZTP Phase (Action Step) in Device Record",
    "aliasName": null,
    "tag": null,
    "description": "Record was changed to an action phase and not a status phase (complete, fail, pending, or disable).",
    "isActive": true,
    "debug": false,
    "singleRecordExecution": false,
    "remoteExecutableFlag": false,
    "parameters": [],
    "synchronous": false,
    "collection": "\/api\/3\/workflow_collections\/5c327ce2-21cc-4a78-bdb8-1edd566042b2",
    "versions": [],
    "triggerStep": "\/api\/3\/workflow_steps\/1e06b8ec-5e9c-49c1-94fa-a4c2b0f413d2",
    "steps": [
        {
            "@type": "WorkflowStep",
            "name": "authorize",
            "description": null,
            "arguments": {
                "when": "{{vars.input.records[0].managementMode == \"Unauthorized\"}}",
                "arguments": {
                    "adom": "{{vars.authadom}}",
                    "device_name": "{{vars.input.records[0].deviceName}}",
                    "connector_config": "{{vars.input.records[0].connectorConfig}}"
                },
                "apply_async": false,
                "step_variables": {
                    "phase_results": "{{vars.steps.authorize}}"
                },
                "pass_parent_env": false,
                "pass_input_record": false,
                "workflowReference": "\/api\/3\/workflows\/fd89a790-ec77-4737-846b-e7a627606068"
            },
            "status": null,
            "top": "40",
            "left": "1160",
            "stepType": "\/api\/3\/workflow_step_types\/74932bdc-b8b6-4d24-88c4-1a4dfbc524f3",
            "group": null,
            "uuid": "463742a9-d7f5-4106-ba45-8cb8609c7354"
        },
        {
            "@type": "WorkflowStep",
            "name": "authorize_vars",
            "description": null,
            "arguments": {
                "authadom": "{%- if \"aDOM\" in vars.input.records[0].zTPProfiles \n      and vars.input.records[0].zTPProfiles.aDOM != '' \n      and vars.input.records[0].zTPProfiles.aDOM != None \n-%}\n{{vars.input.records[0].zTPProfiles.aDOM}}\n{%- else -%}\nroot\n{%- endif -%}"
            },
            "status": null,
            "top": "40",
            "left": "800",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "0bdbfd0c-e143-4a75-b69d-40e168adb59a"
        },
        {
            "@type": "WorkflowStep",
            "name": "create_ztp_steps",
            "description": null,
            "arguments": {
                "step_map": "{%- set profile_mode = vars.ztp_profile_mode -%}\n{%- set steps = {} -%}\n{%- if \"Manual\" in profile_mode -%}\n  {%- for s in vars.step_map_default -%}\n    {%- set _do = steps.update({ s: {\"next_step\":\"Complete\"} }) -%}\n  {%- endfor -%}\n{%- elif vars.step_map_ztp_profile != \"\" -%}\n  {%- set steps = vars.step_map_ztp_profile -%}  \n{%- else -%}\n  {%- set steps = vars.step_map_default -%}  \n{%- endif -%}\n{{steps}}"
            },
            "status": null,
            "top": "140",
            "left": "360",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "2532f825-69f6-4435-9d54-7401d051369a"
        },
        {
            "@type": "WorkflowStep",
            "name": "device_groups_vars",
            "description": null,
            "arguments": {
                "device_groups": "{%- set groups = [] -%}\n{# Get Groups from the ZTP Profile #}\n{%- if \"deviceGroups\" in vars.input.records[0].zTPProfiles \n      and vars.input.records[0].zTPProfiles.deviceGroups != '' \n      and vars.input.records[0].zTPProfiles.deviceGroups != None \n-%}\n  {%- for g in vars.input.records[0].zTPProfiles.deviceGroups.split(\",\") -%}\n    {%- if g not in groups -%}\n      {%- set _do = groups.append(g) -%}\n    {%- endif -%}\n  {%- endfor -%}\n{%- endif -%}\n{# Get Groups from the Device Metadata #}\n{%- set md = vars.input.records[0].deviceMetadata | toDict -%}\n{%- if \"device_groups\" in md  -%}\n  {%- for g in md['device_groups'].split(\",\") -%}\n    {%- if g not in groups -%}\n      {%- set _do = groups.append(g) -%}\n    {%- endif -%}   \n  {%- endfor -%}\n{%- endif -%}\n{{groups}}"
            },
            "status": null,
            "top": "260",
            "left": "1000",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "d3f1570c-ce44-4cc7-b7ad-f63fc7d42290"
        },
        {
            "@type": "WorkflowStep",
            "name": "device_metadata_vars",
            "description": null,
            "arguments": {
                "device_metadata": "{{vars.input.records[0].deviceMetadata}}",
                "device_metadata_total": "{{vars.input.records[0].deviceMetafieldTotal}}",
                "device_metadata_completed": "{{vars.input.records[0].deviceMetafieldCompleted}}",
                "device_metadata_monitor_regex": "{{vars.input.records[0].zTPProfiles.deviceMetadataMonitorRegex|default({})}}"
            },
            "status": null,
            "top": "140",
            "left": "900",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "6163c3b1-6f5b-4ab4-a907-38b25fbc9eb6"
        },
        {
            "@type": "WorkflowStep",
            "name": "incomplete_metafield_vars",
            "description": null,
            "arguments": {
                "step_map": "{%- set mymap = vars.step_map -%}\n{%- set _do = mymap.update({ \"Device Metadata\":{\"next_step\":\"Pending\"}} ) -%}\n{{mymap}}",
                "incomplete_mfd_email": "{% set email_lookup = \n  vars.input.records[0].incompleteMetafieldDeviceMetadataField\n  |default(\"contact_email\") \n-%}\n{% set device_md = vars.input.records[0].deviceMetadata | toDict -%}\n{% set ztp_email = vars.input.records[0].zTPProfiles.incompleteMetafieldEmail -%}\n{%- if email_lookup in device_md -%}\n  {%- if device_md[email_lookup] != None and device_md[email_lookup] != '' -%}  \n    {% set ztp_email = device_md[email_lookup] -%}\n  {%- endif -%}\n{%- endif -%}\n{{ztp_email}}",
                "incomplete_mfd_email_flag": "{{vars.input.records[0].zTPProfiles.incompleteMetafieldEmailEnable}}"
            },
            "status": null,
            "top": "20",
            "left": "2120",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "5d2687f5-6e57-4e52-a888-e3a5e94cf47e"
        },
        {
            "@type": "WorkflowStep",
            "name": "install_device_config_vars",
            "description": null,
            "arguments": [],
            "status": null,
            "top": "940",
            "left": "900",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "d0c4efd4-e7d1-4547-80be-1f97e3eea339"
        },
        {
            "@type": "WorkflowStep",
            "name": "install_policy_pkg_vars",
            "description": null,
            "arguments": {
                "policy_package": "{# Policy Package Name Logic (order)\n   - Device Metadata \"Policy Package\" set.\n   - ZTP Profile\n   - Current Device Policy Package\n   - Device Name\n#}\n{%- set policy = vars.input.records[0].deviceName -%}\n{%- set md = vars.input.records[0].deviceMetadata | toDict -%}\n\n{# Device Record #}\n{%- if vars.input.records[0].policyPackage != ''\n      and vars.input.records[0].policyPackage != None\n-%}\n  {%- set policy = vars.input.records[0].policyPackage -%}\n{%- endif -%}\n\n{# ZTP Profile Record #}\n{%- if \"policyPackage\" in vars.input.records[0].zTPProfiles \n      and vars.input.records[0].zTPProfiles.policyPackage != '' \n      and vars.input.records[0].zTPProfiles.policyPackage != None \n-%}\n  {%- set policy = vars.input.records[0].zTPProfiles.policyPackage -%}\n{%- endif -%}\n\n{# Device Metadata #}\n{%- if \"policy_package\" in md \n      and md['policy_package'] != ''\n      and md['policy_package'] != None\n-%}\n  {%- set policy = md['policy_package'] -%}\n{%- endif -%}\n\n{{policy}}"
            },
            "status": null,
            "top": "1040",
            "left": "780",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "e862d677-59bf-4787-bde7-12adf75fe030"
        },
        {
            "@type": "WorkflowStep",
            "name": "metadata_monitor",
            "description": null,
            "arguments": {
                "metadata_monitor_test": "{# \n  Create an index of metafield matches. \n    match_count:\n    no_match_count:\n    results: field=true or false\n#}\n{%- set md = vars.device_metadata -%}\n{%- set idx = {} -%}\n{%- set _do = idx.update({\"match_count\":0,\"no_match_count\":0,\"no_match_count\":0}) -%}\n{%- set mdrx_data = vars.device_metadata_monitor_regex -%}\n{%- if mdrx_data != None -%}\n  {%- set rxsearch = {} -%}\n  {%- for rxk in mdrx_data -%}\n    {%- if rxk in md -%}\n      {%- if md[rxk] | regex_search(mdrx_data[rxk]) -%}\n        {%- set _do = rxsearch.update({rxk:True}) -%}\n          {%- set _do = idx.update({\"match_count\":idx.match_count+1}) -%}\n        {% else -%}\n          {%- set _do = rxsearch.update({rxk:False}) -%}\n          {%- set _do = idx.update({\"no_match_count\":idx.no_match_count+1}) -%}\n      {%- endif -%}\n    {% endif -%}\n  {%- endfor -%}\n  {%- set _do = idx.update({\"results\":rxsearch}) -%}\n{%- endif -%}\n{{idx}}"
            },
            "status": null,
            "top": "300",
            "left": "2120",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "f697e400-e6a0-4a78-8268-7e71d12bd58a"
        },
        {
            "@type": "WorkflowStep",
            "name": "metafield_complete",
            "description": null,
            "arguments": {
                "conditions": [
                    {
                        "option": "No",
                        "step_iri": "\/api\/3\/workflow_steps\/5d2687f5-6e57-4e52-a888-e3a5e94cf47e",
                        "condition": "{{ vars.device_metadata_completed < vars.device_metadata_total and \"Monitoring\" not in vars.ztpphase_last }}",
                        "step_name": "incomplete_metafield_vars"
                    },
                    {
                        "option": "Yes",
                        "default": true,
                        "step_iri": "\/api\/3\/workflow_steps\/6cfffd94-31c1-44de-b7d8-1750735d2cf8",
                        "step_name": "synch_fmg_meta"
                    }
                ]
            },
            "status": null,
            "top": "80",
            "left": "1800",
            "stepType": "\/api\/3\/workflow_step_types\/12254cf5-5db7-4b1a-8cb1-3af081924b28",
            "group": null,
            "uuid": "46f313cb-b999-4412-ae9a-0beb8afe27b2"
        },
        {
            "@type": "WorkflowStep",
            "name": "metafield_monitor",
            "description": null,
            "arguments": {
                "conditions": [
                    {
                        "option": "Yes",
                        "step_iri": "\/api\/3\/workflow_steps\/5c776ca2-20f2-478c-b0c1-c713b7610fb8",
                        "condition": "{{ vars.metadata_monitor_test.no_match_count > 0 }}",
                        "step_name": "set_monitor_step"
                    },
                    {
                        "option": "No",
                        "default": true,
                        "step_iri": "\/api\/3\/workflow_steps\/96960759-a39a-42c4-9b69-62b9597f1522",
                        "step_name": "ztp_phase_complete_vars"
                    }
                ]
            },
            "status": null,
            "top": "400",
            "left": "2120",
            "stepType": "\/api\/3\/workflow_step_types\/12254cf5-5db7-4b1a-8cb1-3af081924b28",
            "group": null,
            "uuid": "3aca9a33-ed5c-4d02-ba7c-dd6f7ea0e6d6"
        },
        {
            "@type": "WorkflowStep",
            "name": "metafield_monitoring",
            "description": null,
            "arguments": {
                "conditions": [
                    {
                        "option": "Yes",
                        "step_iri": "\/api\/3\/workflow_steps\/f697e400-e6a0-4a78-8268-7e71d12bd58a",
                        "condition": "{{ \"Monitoring\" in vars.ztpphase_last }}",
                        "step_name": "metadata_monitor"
                    },
                    {
                        "option": "No",
                        "default": true,
                        "step_iri": "\/api\/3\/workflow_steps\/46f313cb-b999-4412-ae9a-0beb8afe27b2",
                        "step_name": "metafield_complete"
                    }
                ]
            },
            "status": null,
            "top": "140",
            "left": "1200",
            "stepType": "\/api\/3\/workflow_step_types\/12254cf5-5db7-4b1a-8cb1-3af081924b28",
            "group": null,
            "uuid": "0ecd5a0d-3911-4e83-bebb-6ade93c453fc"
        },
        {
            "@type": "WorkflowStep",
            "name": "request_metafield_input",
            "description": null,
            "arguments": {
                "for_each": {
                    "item": "{{vars.input.records|json_query('[].id')}}",
                    "parallel": false,
                    "condition": ""
                },
                "arguments": {
                    "email": "{%- if vars.incomplete_mfd_email_flag == True -%}\n{{vars.incomplete_mfd_email}}\n{%- endif -%}",
                    "device_ids": "[{{vars.item}}]"
                },
                "apply_async": true,
                "step_variables": [],
                "pass_parent_env": false,
                "pass_input_record": false,
                "workflowReference": "\/api\/3\/workflows\/6663a942-1474-4d45-9536-78d221fc41b3"
            },
            "status": null,
            "top": "100",
            "left": "2120",
            "stepType": "\/api\/3\/workflow_step_types\/74932bdc-b8b6-4d24-88c4-1a4dfbc524f3",
            "group": null,
            "uuid": "1a8f227a-c1f2-4f5c-b28b-f64be928924e"
        },
        {
            "@type": "WorkflowStep",
            "name": "retrieve_config_vars",
            "description": null,
            "arguments": {
                "config_tag": "FortiSOAR ZTP Profile ID:{{vars.input.records[0].zTPProfiles.id}}"
            },
            "status": null,
            "top": "840",
            "left": "1020",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "78ee3def-48f3-4126-8817-0cf99b9ca42f"
        },
        {
            "@type": "WorkflowStep",
            "name": "retrieve_device_config",
            "description": null,
            "arguments": {
                "message": {
                    "tags": [],
                    "type": "\/api\/3\/picklists\/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                    "tenant": "",
                    "thread": false,
                    "content": "<p><strong>Retrieve Device Config<\/strong><\/p>\n<p>&nbsp;<\/p>\n<p>Message: {{vars.steps.retrieve_device_config.output.msg}}<\/p>\n<p>Error: {{vars.steps.retrieve_device_config.output.error}}<\/p>\n<p>&nbsp;<\/p>\n<p>{%- if \"id\" in vars.steps.retrieve_device_config.output.script_data.data.task_response -%}<\/p>\n<p>TaskID:&nbsp;<\/p>\n<p>{{vars.steps.retrieve_device_config.output.script_data.data.task_response.id}}<\/p>\n<p>{%- endif -%}<\/p>\n<p>&nbsp;<\/p>\n<p>{%- if \"id\" in vars.steps.retrieve_device_config.output.script_data.data.task_response -%}<\/p>\n<p>Line:&nbsp;<\/p>\n<p>{{vars.steps.retrieve_device_config.output.script_data.data.task_response.line|json_query('[].[name,state]')}}<\/p>\n<p>{%- endif -%}<\/p>",
                    "records": ""
                },
                "arguments": {
                    "tag": "{{vars.config_tag}}",
                    "adom": "{{vars.input.records[0].aDOM}}",
                    "devices": "{{vars.input.records[0].deviceName}}",
                    "connector_config": "{{vars.input.records[0].connectorConfig}}"
                },
                "apply_async": false,
                "step_variables": {
                    "phase_results": "{{vars.steps.retrieve_device_config}}"
                },
                "pass_parent_env": false,
                "pass_input_record": false,
                "workflowReference": "\/api\/3\/workflows\/fcf7033d-7cb6-444d-8c4d-c5111fc97f05"
            },
            "status": null,
            "top": "840",
            "left": "1400",
            "stepType": "\/api\/3\/workflow_step_types\/74932bdc-b8b6-4d24-88c4-1a4dfbc524f3",
            "group": null,
            "uuid": "4a81852a-49d6-4cdf-bf6c-1ece6c19078c"
        },
        {
            "@type": "WorkflowStep",
            "name": "run_device_group",
            "description": null,
            "arguments": {
                "when": "{{vars.device_groups[0] != ''}}",
                "for_each": {
                    "item": "{{vars.device_groups}}",
                    "parallel": false,
                    "condition": ""
                },
                "arguments": {
                    "adom": "{{vars.input.records[0].aDOM}}",
                    "devices": "{{vars.input.records[0].deviceName}}",
                    "device_group": "{{vars.item}}",
                    "connector_config": "{{vars.input.records[0].connectorConfig}}"
                },
                "apply_async": false,
                "step_variables": {
                    "phase_results": "{{vars.steps.run_device_group}}"
                },
                "pass_parent_env": false,
                "pass_input_record": false,
                "workflowReference": "\/api\/3\/workflows\/def6e18c-0c50-467c-a146-9218e2658019"
            },
            "status": null,
            "top": "260",
            "left": "1320",
            "stepType": "\/api\/3\/workflow_step_types\/74932bdc-b8b6-4d24-88c4-1a4dfbc524f3",
            "group": null,
            "uuid": "e833980d-c02b-48cb-b7b5-9251e255a5e6"
        },
        {
            "@type": "WorkflowStep",
            "name": "run_install_device_config",
            "description": null,
            "arguments": {
                "message": {
                    "tags": [],
                    "type": "\/api\/3\/picklists\/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                    "tenant": "",
                    "thread": false,
                    "content": "<p><strong>Install Device Config<\/strong><\/p>\n<p>&nbsp;<\/p>\n<p>Message: {{vars.steps.run_install_device_config.output.msg}}<\/p>\n<p>Error: {{vars.steps.run_install_device_config.output.error}}<\/p>\n<p>&nbsp;<\/p>\n<p>TaskID:&nbsp;<\/p>\n<p>{{vars.steps.run_install_device_config.output.script_data.data.task_response.id}}<\/p>\n<p>&nbsp;<\/p>\n<p>Line:&nbsp;<\/p>\n<p>{{vars.steps.run_install_device_config.output.script_data.data.task_response.line|json_query('[].[name,state]')}}<\/p>\n<p>&nbsp;<\/p>\n<p>History:<br \/>{{vars.steps.run_install_device_config.output.script_data.data.task_response.line[0].history|json_query('[].[detail,percent]')}}<\/p>",
                    "records": ""
                },
                "arguments": {
                    "adom": "{{vars.input.records[0].aDOM}}",
                    "devices": "{{vars.input.records[0].deviceName}}",
                    "connector_config": "{{vars.input.records[0].connectorConfig}}"
                },
                "apply_async": false,
                "step_variables": {
                    "phase_results": "{{vars.steps.run_install_device_config}}"
                },
                "pass_parent_env": false,
                "pass_input_record": false,
                "workflowReference": "\/api\/3\/workflows\/e2a6fb3a-394a-472f-bf2b-82a42296360e"
            },
            "status": null,
            "top": "940",
            "left": "1240",
            "stepType": "\/api\/3\/workflow_step_types\/74932bdc-b8b6-4d24-88c4-1a4dfbc524f3",
            "group": null,
            "uuid": "93c21c3a-d15f-493e-bc0c-96bd547f8b95"
        },
        {
            "@type": "WorkflowStep",
            "name": "run_install_policy_pkg",
            "description": null,
            "arguments": {
                "when": "{{vars.policy_package != None}}",
                "message": {
                    "tags": [],
                    "type": "\/api\/3\/picklists\/ff599189-3eeb-4c86-acb0-a7915e85ac3b",
                    "tenant": "",
                    "thread": false,
                    "content": "<p><strong>Install Policy Package ( {{vars.policy_package}} )<\/strong><\/p>\n<p>&nbsp;<\/p>\n<p>Message: {{vars.steps.run_install_policy_pkg.output.msg}}<\/p>\n<p>Error: {{vars.steps.run_install_policy_pkg.output.error}}<\/p>\n<p>&nbsp;<\/p>\n<p>TaskID:&nbsp;<\/p>\n<p>{{vars.steps.run_install_policy_pkg.output.script_data.data.task_response.id}}<\/p>\n<p>&nbsp;<\/p>\n<p>Line:&nbsp;<\/p>\n<p>{{vars.steps.run_install_policy_pkg.output.script_data.data.task_response.line|json_query('[].[name,state]')}}<\/p>\n<p>&nbsp;<\/p>\n<p>History:<br \/>{{vars.steps.run_install_policy_pkg.output.script_data.data.task_response.line[0].history|json_query('[].[detail,percent]')}}<\/p>",
                    "records": ""
                },
                "arguments": {
                    "adom": "{{vars.input.records[0].aDOM}}",
                    "devices": "{{vars.input.records[0].deviceName}}",
                    "package": "{{vars.policy_package}}",
                    "connector_config": "{{vars.input.records[0].connectorConfig}}",
                    "assign_device_flag": "True"
                },
                "apply_async": false,
                "step_variables": {
                    "phase_results": "{{vars.steps.run_install_policy_pkg}}"
                },
                "pass_parent_env": false,
                "pass_input_record": false,
                "workflowReference": "\/api\/3\/workflows\/ad544501-706a-48af-972e-e1035f81c021"
            },
            "status": null,
            "top": "1040",
            "left": "1160",
            "stepType": "\/api\/3\/workflow_step_types\/74932bdc-b8b6-4d24-88c4-1a4dfbc524f3",
            "group": null,
            "uuid": "32017c43-86e5-483d-8df5-df6416c2c06a"
        },
        {
            "@type": "WorkflowStep",
            "name": "run linked scripts",
            "description": null,
            "arguments": {
                "arguments": {
                    "device_record_id": "{{vars.input.records[0].id}}"
                },
                "apply_async": false,
                "step_variables": {
                    "phase_results": "{{vars.steps.run_linked_scripts}}"
                },
                "pass_parent_env": false,
                "pass_input_record": false,
                "workflowReference": "\/api\/3\/workflows\/40821204-db12-4122-8ecd-ba6e944a058c"
            },
            "status": null,
            "top": "720",
            "left": "1460",
            "stepType": "\/api\/3\/workflow_step_types\/74932bdc-b8b6-4d24-88c4-1a4dfbc524f3",
            "group": null,
            "uuid": "eacd0ca0-f11f-458f-8465-7eda07222054"
        },
        {
            "@type": "WorkflowStep",
            "name": "run_linked_scripts_vars",
            "description": null,
            "arguments": [],
            "status": null,
            "top": "720",
            "left": "1140",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "0ecd9d9f-3be8-4fa7-9738-e181666aedbd"
        },
        {
            "@type": "WorkflowStep",
            "name": "set_initial_vars",
            "description": null,
            "arguments": {
                "ztp_profile": "{{vars.input.records[0].zTPProfiles.name}}",
                "ztpphase_last": "{{vars.input.records[0].zTPPhaseLast.itemValue}}",
                "ztpphase_input": "{{vars.input.records[0].zTPPhase.itemValue}}",
                "step_map_default": "{\n  \"Authorize\" : {\n    \"next_step\" : \"Device Groups\"\n  },\n  \"Device Metadata\": {\n    \"next_step\" : \"Device Groups\"\n  },\n  \"Device Groups\": {\n    \"next_step\" : \"Run Linked Scripts\"\n  },\n  \"Run Linked Scripts\": {\n    \"next_step\" : \"Install Device Config\"\n  },\n  \"Install Device Config\": {\n    \"next_step\" : \"Install Policy Package\"\n  },\n  \"Install Policy Package\": {\n    \"next_step\" : \"Complete\"\n  } \n}",
                "ztp_profile_mode": "{%- set prof = vars.input.records[0].zTPProfiles.profileMode \n    | fromIRI \n    | json_query('itemValue')\n-%}\n{%- if prof != None -%}\n{{prof}}\n{%- else -%}\n\"Manual\"\n{%- endif -%}",
                "step_map_ztp_profile": "{{vars.input.records[0].zTPProfiles.zTPStepMap}}"
            },
            "status": null,
            "top": "40",
            "left": "360",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "5914a5bf-43b4-43b9-a98f-cb57a79181bb"
        },
        {
            "@type": "WorkflowStep",
            "name": "set_monitor_step",
            "description": null,
            "arguments": {
                "step_map": "{%- set mymap = vars.step_map -%}\n{%- set _do = mymap.update({ \"Device Metadata\":{\"next_step\":\"Monitoring\"}} ) -%}\n{{mymap}}"
            },
            "status": null,
            "top": "460",
            "left": "2480",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "5c776ca2-20f2-478c-b0c1-c713b7610fb8"
        },
        {
            "@type": "WorkflowStep",
            "name": "Start",
            "description": null,
            "arguments": {
                "resource": "devices",
                "resources": [
                    "devices"
                ],
                "step_variables": {
                    "input": {
                        "params": [],
                        "records": [
                            "{{vars.input.records[0]}}"
                        ]
                    },
                    "status_update_html": "<img src=\"data:image\/gif;base64,R0lGODlhDQANAPQAAAAAABMTExUVFR8fHyoqKi4uLj8\/P1FRUVVVVWBgYGpqam5ubn9\/f5CQkJSUlJ6enqmpqa2trb+\/v9DQ0NTU1ODg4Ovr6+\/v7\/\/\/\/wAAAAAAAAAAAAAAAAAAAAAAAAAAACH\/C05FVFNDQVBFMi4wAwEAAAAh+QQFBAAAACH\/C0ltYWdlTWFnaWNrDmdhbW1hPTAuNDU0NTQ1ACH+J0dJRiByZXNpemVkIG9uIGh0dHBzOi8vZXpnaWYuY29tL3Jlc2l6ZQAh\/wt4bXAgZGF0YXhtcP8\/eHBhY2tldCBiZWdpbj0i77u\/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG10YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxMTEgNzkuMTU4MzI1LCAyMDE1LzA5LzEwLTAxOjEwOjIwICAgICAgICAiPjxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53Lm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZjphYm91dD0iIiD\/eG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1uczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxNSAoTWFjaW50b3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOkFFODBBQUU0MUJBQjExRTY5MkUyRDRBNjI4MDc1\/zM1RSIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpBRTgwQUFFNTFCQUIxMUU5MkUyRDRBNjI4MDc1MzVFIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQieG1wLmlpZDpBRTgwQUFFMjFCQUIxMUU2OTJFMkQ0QTYyODA3NTM1RSIgc3RSZWY6ZG9jdW1lbnRJRD0ibXAuZGlkOkFFODBBQUUzMUJBQjExRTY5MkUyRDRBNjI4MDc1MzVFIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZf90IGVuZD0iciI\/PgH\/\/v38+\/r5+Pf29fTz8vDv7u3s6+rp6Ofm5eTj4uHg397d3Nva2djX1tXU09LR0M\/OzczLysnIx8bFxMPCwcC\/vr28u7q5uLe2tbSzsrGwr66trKuqqainpqWko6KhoJ+enZybmpmYl5aVlJOSkZCPjo2Mi4qJiIeGhYSDgoGAf359fHt6eXh3dnV0c3JxcG9ubWxramloZ2ZlZGNiYWBfXl1cW1pZWFdWVVRTUlFQT05NTEtKSUhHRkVEQ0JBQD8+PTw7Ojk4NzY1NDMyMTAvLi0sKyopKCcmJSQjIiEgHx4dHBsaGRgXFhUUExIREA8ODQwMCwoJCAcGBQQDAgEAACwAAAAADQANAAAFSSAgjtJoipBYAtQJQGlJtaPjvJE0tZZVO49RpXdqnC4jhpJxwjgxo8XJcFIoEqNBIDCyAhAHQ4EAEAhMCASASiCf1GuR2xU\/hQAAIfkECQQAAAAh\/wtJbWFnZU1hZ2ljaw5nYW1tYT0wLjQ1NDU0NQAsAgAAAA0ADQAAAguEj6nL7Q+jnLTSAgAh+QQFBAAAACH\/C0ltYWdlTWFnaWNrDmdhbW1hPTAuNDU0NTQ1ACwAAAAADQANAIQAAAAREREVFRUZGRkqKio7Ozs\/Pz9KSkpVVVVZWVlqamp7e3t\/f3+KioqUlJSYmJipqam7u7u\/v7\/JycnU1NTY2Njr6+v8\/Pz\/\/\/8AAAAAAAAAAAAAAAAAAAAAAAAAAAAFSSAgjtBoio5YAtIJOGkptSPDvA8UtRRVM43RpHdanCojhVJxsjgto8QJc0IgDqMGhiqyAgwFwkAA2JoMBgABIAi40moR2SVan0IAIfkECQQAAAAh\/wtJbWFnZU1hZ2ljaw5nYW1tYT0wLjQ1NDU0NQAsAQABAA0ADQAAAguEj6nL7Q+jnLTSAgAh+QQFBAAAACH\/C0ltYWdlTWFnaWNrDmdhbW1hPTAuNDU0NTQ1ACwAAAAADQANAIQAAAAODg4SEhIVFRUmJiYqKio0NDQ\/Pz9DQ0NVVVVmZmZqamp1dXV\/f3+Dg4OUlJSlpaWpqam0tLS\/v7\/Dw8PU1NTV1dXn5+fr6+v19fX7+\/v+\/v7\/\/\/8AAAAAAAAAAAAFSiAgjs9oio1YAtEJNGkZteOyvM4DtdNUL4yRpHdSnCijhDJxsjgtI8TpcjocDKMMBjOyAgqEgIUD2JoKBYAAwNG40oCBiOwSyU8hACH5BAkEAAAAIf8LSW1hZ2VNYWdpY2sOZ2FtbWE9MC40NTQ1NDUALAAAAQANAA0AAAILhI+py+0Po5y00gIAIfkEBQQAAAAh\/wtJbWFnZU1hZ2ljaw5nYW1tYT0wLjQ1NDU0NQAsAAAAAA0ADQAABUkgII7MaIqKWALOCShp6bQjgrwL07QQVNujR+90OEVGhqThJGlKRoXT5EQgDEYVCmVUBQQMmIsFoDUJAgAMwDI+CUTqtWsUN4UAACH5BAkEAAAAIf8LSW1hZ2VNYWdpY2sOZ2FtbWE9MC40NTQ1NDUALAAAAQANAA0AAAILhI+py+0Po5y00gIAIfkEBQQAAAAh\/wtJbWFnZU1hZ2ljaw5nYW1tYT0wLjQ1NDU0NQAsAAAAAA0ADQCEAAAAERERFRUVGRkZKioqOzs7Pz8\/SkpKVVVVWVlZampqe3t7f39\/ioqKlJSUmJiYqampu7u7v7+\/ycnJ1NTU2NjY6+vr\/Pz8\/v7+\/\/\/\/AAAAAAAAAAAAAAAAAAAAAAAABUkgII7KaIqIWALMCSBpybSjYbyJsrSOUxuHUaN3KpweI4KScII4IaPBKXISCBqjiUQyEgQAGIylQgFsTWGABUApnzCiNds1kptCACH5BAkEAAAAIf8LSW1hZ2VNYWdpY2sOZ2FtbWE9MC40NTQ1NDUALAAAAQANAA0AAAILhI+py+0Po5y00gIAIfkEBQQAAAAh\/wtJbWFnZU1hZ2ljaw5nYW1tYT0wLjQ1NDU0NQAsAAAAAA0ADQCEAAAADg4OEhISFRUVJiYmKioqNDQ0Pz8\/Q0NDVVVVZmZmampqdXV1f39\/g4ODlJSUpaWlqamptLS0v7+\/w8PD1NTU1dXV5+fn6+vr9fX1\/\/\/\/AAAAAAAAAAAAAAAAAAAABUkgII7JaIqHWALLCRxpubRjUbxIorRNUxeGEaN3Ipwco8FAEDg9no+R5QQ5aTSZkSQSGV0BmIuFMgFwTRgMYDopn9RrkdsVP4UAACH5BAkEAAAAIf8LSW1hZ2VNYWdpY2sOZ2FtbWE9MC40NTQ1NDUALAAAAAANAA0AAAILhI+py+0Po5y00gIAIfkEBQQAAAAh\/wtJbWFnZU1hZ2ljaw5nYW1tYT0wLjQ1NDU0NQAsAAAAAA0ADQAABUkgII7GaIqEWALICRBpibSjILyFcbSKMgaBwSjRO61GixFmiTkxnozR5dQ4WSyV0cPhGF0BlIkkAgFwTRQKQAKAlE\/qtejtkp9CACH5BAkEAAAAIf8LSW1hZ2VNYWdpY2sOZ2FtbWE9MC40NTQ1NDUALAAAAAANAA0AAAILhI+py+0Po5y00gIAIfkEBQQAAAAh\/wtJbWFnZU1hZ2ljaw5nYW1tYT0wLjQ1NDU0NQAsAAAAAA0ADQCEAAAAERERFRUVGRkZKioqOzs7Pz8\/SkpKVVVVWVlZampqe3t7f39\/ioqKlJSUmJiYqampu7u7v7+\/ycnJ1NTU2NjY6+vr\/Pz8\/\/\/\/AAAAAAAAAAAAAAAAAAAAAAAAAAAABUkgII7EaIqCWALGCQRpabQjhgHCQBQtgtSYxujgO91MiZFlaTkpnopR5bQ4USiTUYPBGF0Bkgjk4QBwTRIJAAJwlE\/qtejtkp9CACH5BAkEAAAAIf8LSW1hZ2VNYWdpY2sOZ2FtbWE9MC40NTQ1NDUALAAAAAANAA0AAAILhI+py+0Po5y00gIAIfkEBQQAAAAh\/wtJbWFnZU1hZ2ljaw5nYW1tYT0wLjQ1NDU0NQAsAAAAAA0ADQCEAAAADg4OEhISFRUVJiYmKioqNDQ0Pz8\/Q0NDVVVVZmZmampqdXV1f39\/g4ODlJSUpaWlqamptLS0v7+\/w8PD1NTU1dXV5+fn6+vr9fX1+\/v7\/v7+\/\/\/\/AAAAAAAAAAAABUkgII7DaIqbWALFCWipwLYjhgGbFRDtcdSYzMjgO11OiJFlaTklnokR5aQ4TSaSEWOxGF0BEcjD0QBwTZEI4AFolE\/qtejtkp9CACH5BAkEAAAAIf8LSW1hZ2VNYWdpY2sOZ2FtbWE9MC40NTQ1NDUALAAAAQANAA0AAAILhI+py+0Po5y00gIAIfkEBQQAAAAh\/wtJbWFnZU1hZ2ljaw5nYW1tYT0wLjQ1NDU0NQAsAAAAAA0ADQAABUkgII7YaIqWWALCCVhpGbQjRb0XZgQAQdS20cB3mpwKI4lScjI4DaPI6XCCQB6jBAIxsgIcDcZCAdiaHA4AA6Agn9JqkdsVP4UAACH5BAkEAAAAIf8LSW1hZ2VNYWdpY2sOZ2FtbWE9MC40NTQ1NDUALAAAAAANAA0AAAILhI+py+0Po5y00gIAIfkEBQQAAAAh\/wtJbWFnZU1hZ2ljaw5nYW1tYT0wLjQ1NDU0NQAsAAAAAA0ADQCEAAAAERERFRUVGRkZKioqOzs7Pz8\/SkpKVVVVWVlZampqe3t7f39\/ioqKlJSUmJiYqampu7u7v7+\/ycnJ1NTU2NjY6+vr\/Pz8\/\/\/\/AAAAAAAAAAAAAAAAAAAAAAAAAAAABUkgII7WaIqUWALXCVBpebWjJL2VNQOBUEuTUUPgM0VOgxFkCTkRnoTR41Q4ORyN0cFgGF0BjIUigQBwTQwGQAFAlE\/qtejtkp9CACH5BAkEAAAAIf8LSW1hZ2VNYWdpY2sOZ2FtbWE9MC40NTQ1NDUALAEAAAANAA0AAAILhI+py+0Po5y00gIAIfkEBQQAAAAh\/wtJbWFnZU1hZ2ljaw5nYW1tYT0wLjQ1NDU0NQAsAAAAAA0ADQCEAAAADg4OEhISFRUVJiYmKioqNDQ0Pz8\/Q0NDVVVVZmZmampqdXV1f39\/g4ODlJSUpaWlqamptLS0v7+\/w8PD1NTU1dXV5+fn6+vr9fX1\/\/\/\/AAAAAAAAAAAAAAAAAAAABUkgII7VaIqTWALYCUxpibVjFL1UdbWaVkeSUaZ3gpxWgIfycQoIBoOR40Q4NRqMkaFQGF0BC0UCcQBwTYsFIAE4lE\/qtejtkp9CACH5BAUEAAAAIf8LSW1hZ2VNYWdpY2sOZ2FtbWE9MC40NTQ1NDUALAAAAAANAA0AAAILhI+py+0Po5y00gIAOw==\">",
                    "ztpphase_input_OLD": "{{vars.input.records[0].zTPPhase.itemValue}}"
                },
                "fieldbasedtrigger": {
                    "sort": [],
                    "limit": 30,
                    "logic": "AND",
                    "filters": [
                        {
                            "type": "object",
                            "field": "zTPPhase",
                            "value": "",
                            "_value": {
                                "@id": "",
                                "display": "",
                                "itemValue": ""
                            },
                            "operator": "changed"
                        },
                        {
                            "type": "array",
                            "field": "zTPPhase",
                            "value": [
                                "\/api\/3\/picklists\/8facfd8e-4927-4a88-9019-a7bbcf8f8ef6",
                                "\/api\/3\/picklists\/97f72cac-62ef-4942-8d7e-45351a5e89fa",
                                "\/api\/3\/picklists\/49ac6717-17c9-42dd-ac92-4d2ddff4399e",
                                "\/api\/3\/picklists\/4c2a1f21-06f0-41b8-829b-5bf26b6f41a5",
                                "\/api\/3\/picklists\/1d8b9c23-9bbb-4fbb-8bc0-4eb0f41547e5",
                                "\/api\/3\/picklists\/2c58d669-3dfa-452f-b0f1-2adc302f3630",
                                "\/api\/3\/picklists\/c3795e1c-33a5-46c2-89fa-d1eef6d548a5"
                            ],
                            "module": "zTPPhase",
                            "display": "",
                            "operator": "in",
                            "template": "multiselectpicklist",
                            "OPERATOR_KEY": "$",
                            "useInOperator": true,
                            "previousOperator": "in",
                            "previousTemplate": "multiselectpicklist"
                        }
                    ]
                }
            },
            "status": null,
            "top": "40",
            "left": "40",
            "stepType": "\/api\/3\/workflow_step_types\/9300bf69-5063-486d-b3a6-47eb9da24872",
            "group": null,
            "uuid": "1e06b8ec-5e9c-49c1-94fa-a4c2b0f413d2"
        },
        {
            "@type": "WorkflowStep",
            "name": "synch_device_db_device",
            "description": null,
            "arguments": {
                "arguments": {
                    "device_name": "{{vars.input.records[0].deviceName}}",
                    "connector_config": "{{vars.input.records[0].connectorConfig}}"
                },
                "apply_async": false,
                "step_variables": [],
                "pass_parent_env": false,
                "pass_input_record": false,
                "workflowReference": "\/api\/3\/workflows\/7785b049-a481-4c37-b7b9-8e2ebe68d363"
            },
            "status": null,
            "top": "600",
            "left": "2440",
            "stepType": "\/api\/3\/workflow_step_types\/74932bdc-b8b6-4d24-88c4-1a4dfbc524f3",
            "group": null,
            "uuid": "03b25d7a-fa43-44cf-af4b-76528131fa7f"
        },
        {
            "@type": "WorkflowStep",
            "name": "synch_fmg_meta",
            "description": null,
            "arguments": {
                "when": "{{vars.input.records[0].zTPProfiles.exportMetadataToFortiManager and vars.step_map[vars.ztpphase_input].next_step != \"Pending\"}}",
                "arguments": {
                    "device_name": "{{vars.input.records[0].deviceName}}",
                    "connector_config": "{{vars.input.records[0].connectorConfig}}"
                },
                "apply_async": false,
                "step_variables": [],
                "pass_parent_env": false,
                "pass_input_record": false,
                "workflowReference": "\/api\/3\/workflows\/35ad5541-0cc1-492e-912d-b6d41f9a5739"
            },
            "status": null,
            "top": "180",
            "left": "2120",
            "stepType": "\/api\/3\/workflow_step_types\/74932bdc-b8b6-4d24-88c4-1a4dfbc524f3",
            "group": null,
            "uuid": "6cfffd94-31c1-44de-b7d8-1750735d2cf8"
        },
        {
            "@type": "WorkflowStep",
            "name": "update_next_step",
            "description": null,
            "arguments": {
                "arguments": {
                    "ztp_phase": "{{vars.next_step}}",
                    "device_record_iri_list": "{{vars.input.records|json_query('[].\"@id\"')}}"
                },
                "apply_async": false,
                "step_variables": [],
                "pass_parent_env": false,
                "pass_input_record": false,
                "workflowReference": "\/api\/3\/workflows\/631185b1-46c7-4881-9995-2774f1b9d831"
            },
            "status": null,
            "top": "740",
            "left": "2440",
            "stepType": "\/api\/3\/workflow_step_types\/74932bdc-b8b6-4d24-88c4-1a4dfbc524f3",
            "group": null,
            "uuid": "be43c13b-61d0-4ca8-bf64-164288ff45e9"
        },
        {
            "@type": "WorkflowStep",
            "name": "ztp_phase",
            "description": null,
            "arguments": {
                "conditions": [
                    {
                        "option": "Not Supported",
                        "default": true,
                        "step_iri": "\/api\/3\/workflow_steps\/25aea552-966b-4df8-b13c-078cc1174d9d",
                        "step_name": "ztp_phase_skipped"
                    },
                    {
                        "option": "Authorize",
                        "step_iri": "\/api\/3\/workflow_steps\/0bdbfd0c-e143-4a75-b69d-40e168adb59a",
                        "condition": "{{ vars.ztpphase_input == \"Authorize\" }}",
                        "step_name": "authorize_vars"
                    },
                    {
                        "option": "Device Metadata",
                        "step_iri": "\/api\/3\/workflow_steps\/6163c3b1-6f5b-4ab4-a907-38b25fbc9eb6",
                        "condition": "{{ vars.ztpphase_input == \"Device Metadata\" }}",
                        "step_name": "device_metadata_vars"
                    },
                    {
                        "option": "Device Groups",
                        "step_iri": "\/api\/3\/workflow_steps\/d3f1570c-ce44-4cc7-b7ad-f63fc7d42290",
                        "condition": "{{ vars.ztpphase_input == \"Device Groups\" }}",
                        "step_name": "device_groups_vars"
                    },
                    {
                        "option": "Run Linked Scripts",
                        "step_iri": "\/api\/3\/workflow_steps\/0ecd9d9f-3be8-4fa7-9738-e181666aedbd",
                        "condition": "{{ vars.ztpphase_input == \"Run Linked Scripts\" }}",
                        "step_name": "run_linked_scripts_vars"
                    },
                    {
                        "option": "Install Device Config",
                        "step_iri": "\/api\/3\/workflow_steps\/d0c4efd4-e7d1-4547-80be-1f97e3eea339",
                        "condition": "{{ vars.ztpphase_input == \"Install Device Config\" }}",
                        "step_name": "install_device_config_vars"
                    },
                    {
                        "option": "Install Policy Package",
                        "step_iri": "\/api\/3\/workflow_steps\/e862d677-59bf-4787-bde7-12adf75fe030",
                        "condition": "{{ vars.ztpphase_input == \"Install Policy Package\" }}",
                        "step_name": "install_policy_pkg_vars"
                    },
                    {
                        "option": "Retrieve Device Config",
                        "step_iri": "\/api\/3\/workflow_steps\/78ee3def-48f3-4126-8817-0cf99b9ca42f",
                        "condition": "{{ vars.ztpphase_input == \"Retrieve Device Config\" }}",
                        "step_name": "retrieve_config_vars"
                    }
                ]
            },
            "status": null,
            "top": "540",
            "left": "360",
            "stepType": "\/api\/3\/workflow_step_types\/12254cf5-5db7-4b1a-8cb1-3af081924b28",
            "group": null,
            "uuid": "898a754f-6d8a-401e-8958-6c8bf5540e34"
        },
        {
            "@type": "WorkflowStep",
            "name": "ztp_phase_complete",
            "description": null,
            "arguments": {
                "resource": {
                    "zTPStatus": "Done",
                    "zTPPhaseLast": "{{\"ZTP Phase\"|picklist(vars.ztpphase_input)}}",
                    "zTPStatusHTML": "<p style=\"text-align: left;\"><span style=\"border: 2px solid GREEN; color: green; border-radius: 5px; background-color: black; font-family: verdana; font-weight: bold; font-size: 10px; padding: 2px;\"> Done <\/span><\/p>",
                    "zTPPhaseStarted": "null",
                    "zTPPhaseCompleted": "{{arrow.utcnow().int_timestamp}}"
                },
                "operation": "Append",
                "collection": "{{vars.input.records[0]['@id']}}",
                "__recommend": [],
                "collectionType": "\/api\/3\/devices",
                "fieldOperation": [],
                "step_variables": []
            },
            "status": null,
            "top": "680",
            "left": "2120",
            "stepType": "\/api\/3\/workflow_step_types\/b593663d-7d13-40ce-a3a3-96dece928722",
            "group": null,
            "uuid": "da90c418-fff8-473f-8974-323acfcc4f7b"
        },
        {
            "@type": "WorkflowStep",
            "name": "ztp_phase_complete_vars",
            "description": null,
            "arguments": {
                "next_step": "{%- set next_step = vars.step_map[vars.ztpphase_input].next_step|default(\"Complete\") -%}\n{%- set phase_results = vars.phase_results|default({}) -%}\n{%- if \"output\" in phase_results -%}\n  {%- if phase_results.output.error == True -%}\n    {%- set next_step = \"Fail\" -%}\n  {%- endif -%}\n{%- endif -%}\n{{next_step}}"
            },
            "status": null,
            "top": "520",
            "left": "2120",
            "stepType": "\/api\/3\/workflow_step_types\/04d0cf46-b6a8-42c4-8683-60a7eaa69e8f",
            "group": null,
            "uuid": "96960759-a39a-42c4-9b69-62b9597f1522"
        },
        {
            "@type": "WorkflowStep",
            "name": "ztp_phase_skipped",
            "description": null,
            "arguments": {
                "resource": {
                    "zTPPhase": "{{\"ZTP Phase\"|picklist(\"Complete\")}}",
                    "zTPStatus": "Done",
                    "zTPPhaseLast": "{{\"ZTP Phase\"|picklist(vars.ztpphase_input)}}",
                    "zTPStatusHTML": "<p style=\"text-align: center;\"><span style=\"border: 2px solid GREEN; color: green; border-radius: 5px; background-color: black; font-family: verdana; font-weight: bold; font-size: 10px; padding: 2px;\"> Done <\/span><\/p>",
                    "zTPPhaseStarted": "null",
                    "zTPPhaseCompleted": "{{arrow.utcnow().int_timestamp}}"
                },
                "operation": "Append",
                "collection": "{{vars.input.records[0]['@id']}}",
                "__recommend": [],
                "collectionType": "\/api\/3\/devices",
                "fieldOperation": [],
                "step_variables": []
            },
            "status": null,
            "top": "120",
            "left": "40",
            "stepType": "\/api\/3\/workflow_step_types\/b593663d-7d13-40ce-a3a3-96dece928722",
            "group": null,
            "uuid": "25aea552-966b-4df8-b13c-078cc1174d9d"
        },
        {
            "@type": "WorkflowStep",
            "name": "ztp_phase_started",
            "description": null,
            "arguments": {
                "resource": {
                    "zTPStatus": "Running",
                    "zTPStatusHTML": "<p style=\"text-align: center;\">{{vars.status_update_html}}<\/p>",
                    "zTPPhaseStarted": "{{arrow.utcnow().int_timestamp}}",
                    "zTPPhaseCompleted": "null"
                },
                "operation": "Append",
                "collection": "{{vars.input.records[0]['@id']}}",
                "__recommend": [],
                "collectionType": "\/api\/3\/devices",
                "fieldOperation": [],
                "step_variables": []
            },
            "status": null,
            "top": "260",
            "left": "360",
            "stepType": "\/api\/3\/workflow_step_types\/b593663d-7d13-40ce-a3a3-96dece928722",
            "group": null,
            "uuid": "581d6f7a-6f54-4fed-a9a1-fe1b2534c664"
        }
    ],
    "routes": [
        {
            "@type": "WorkflowRoute",
            "name": "authorize -> ztp_phase_complete_vars",
            "targetStep": "\/api\/3\/workflow_steps\/96960759-a39a-42c4-9b69-62b9597f1522",
            "sourceStep": "\/api\/3\/workflow_steps\/463742a9-d7f5-4106-ba45-8cb8609c7354",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "5e643e2f-7d1f-41e9-a962-a26b67d256c0"
        },
        {
            "@type": "WorkflowRoute",
            "name": "auth_vars -> authorize",
            "targetStep": "\/api\/3\/workflow_steps\/463742a9-d7f5-4106-ba45-8cb8609c7354",
            "sourceStep": "\/api\/3\/workflow_steps\/0bdbfd0c-e143-4a75-b69d-40e168adb59a",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "02afadec-5d82-4fa0-8008-2d3557735841"
        },
        {
            "@type": "WorkflowRoute",
            "name": "create_ztp_steps -> ztp_phase_started",
            "targetStep": "\/api\/3\/workflow_steps\/581d6f7a-6f54-4fed-a9a1-fe1b2534c664",
            "sourceStep": "\/api\/3\/workflow_steps\/2532f825-69f6-4435-9d54-7401d051369a",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "e861d9fa-986e-446c-9149-24848a5749d2"
        },
        {
            "@type": "WorkflowRoute",
            "name": "device_groups_vars -> run_device_group",
            "targetStep": "\/api\/3\/workflow_steps\/e833980d-c02b-48cb-b7b5-9251e255a5e6",
            "sourceStep": "\/api\/3\/workflow_steps\/d3f1570c-ce44-4cc7-b7ad-f63fc7d42290",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "0a787079-7757-4d42-80c1-9fc49d306641"
        },
        {
            "@type": "WorkflowRoute",
            "name": "device_metadata_vars -> metafield_monitoring",
            "targetStep": "\/api\/3\/workflow_steps\/0ecd5a0d-3911-4e83-bebb-6ade93c453fc",
            "sourceStep": "\/api\/3\/workflow_steps\/6163c3b1-6f5b-4ab4-a907-38b25fbc9eb6",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "392620ef-96aa-4e03-bab0-99ee964c72c2"
        },
        {
            "@type": "WorkflowRoute",
            "name": "install_device_config_vars -> run_install_device_config",
            "targetStep": "\/api\/3\/workflow_steps\/93c21c3a-d15f-493e-bc0c-96bd547f8b95",
            "sourceStep": "\/api\/3\/workflow_steps\/d0c4efd4-e7d1-4547-80be-1f97e3eea339",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "82bf3301-24eb-4e50-89e6-420f9bd6204f"
        },
        {
            "@type": "WorkflowRoute",
            "name": "install_policy_pkg_vars -> run_install_policy_pkg",
            "targetStep": "\/api\/3\/workflow_steps\/32017c43-86e5-483d-8df5-df6416c2c06a",
            "sourceStep": "\/api\/3\/workflow_steps\/e862d677-59bf-4787-bde7-12adf75fe030",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "7cc289dc-8a10-432d-b4b1-578d8d8bfca3"
        },
        {
            "@type": "WorkflowRoute",
            "name": "metadata_monitor -> metafield_monitor",
            "targetStep": "\/api\/3\/workflow_steps\/3aca9a33-ed5c-4d02-ba7c-dd6f7ea0e6d6",
            "sourceStep": "\/api\/3\/workflow_steps\/f697e400-e6a0-4a78-8268-7e71d12bd58a",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "6e0620f8-722c-4b69-8e6a-8d89f9d516e7"
        },
        {
            "@type": "WorkflowRoute",
            "name": "metafield_complete -> override_stepmap",
            "targetStep": "\/api\/3\/workflow_steps\/5d2687f5-6e57-4e52-a888-e3a5e94cf47e",
            "sourceStep": "\/api\/3\/workflow_steps\/46f313cb-b999-4412-ae9a-0beb8afe27b2",
            "label": "No",
            "isExecuted": false,
            "group": null,
            "uuid": "3a033bdc-c3da-4637-a2fa-01bd1d11ffa7"
        },
        {
            "@type": "WorkflowRoute",
            "name": "metafield_complete -> synch_fmg_meta",
            "targetStep": "\/api\/3\/workflow_steps\/6cfffd94-31c1-44de-b7d8-1750735d2cf8",
            "sourceStep": "\/api\/3\/workflow_steps\/46f313cb-b999-4412-ae9a-0beb8afe27b2",
            "label": "Yes",
            "isExecuted": false,
            "group": null,
            "uuid": "1898df53-c986-4f73-8a6b-750a130e75eb"
        },
        {
            "@type": "WorkflowRoute",
            "name": "metafield_monitoring -> metadata_monitor",
            "targetStep": "\/api\/3\/workflow_steps\/f697e400-e6a0-4a78-8268-7e71d12bd58a",
            "sourceStep": "\/api\/3\/workflow_steps\/0ecd5a0d-3911-4e83-bebb-6ade93c453fc",
            "label": "Yes",
            "isExecuted": false,
            "group": null,
            "uuid": "11f7c331-3941-4cd1-b58d-6e19a701d2e8"
        },
        {
            "@type": "WorkflowRoute",
            "name": "metafield_monitoring -> metafield_complete",
            "targetStep": "\/api\/3\/workflow_steps\/46f313cb-b999-4412-ae9a-0beb8afe27b2",
            "sourceStep": "\/api\/3\/workflow_steps\/0ecd5a0d-3911-4e83-bebb-6ade93c453fc",
            "label": "No",
            "isExecuted": false,
            "group": null,
            "uuid": "cd75c8ab-042b-4ebb-97fc-3925865a27eb"
        },
        {
            "@type": "WorkflowRoute",
            "name": "metafield_monitor -> set_monitor_step",
            "targetStep": "\/api\/3\/workflow_steps\/5c776ca2-20f2-478c-b0c1-c713b7610fb8",
            "sourceStep": "\/api\/3\/workflow_steps\/3aca9a33-ed5c-4d02-ba7c-dd6f7ea0e6d6",
            "label": "Yes",
            "isExecuted": false,
            "group": null,
            "uuid": "44314478-33fe-4266-ad3b-898a4168e9fa"
        },
        {
            "@type": "WorkflowRoute",
            "name": "metafield_monitor -> ztp_phase_complete_vars",
            "targetStep": "\/api\/3\/workflow_steps\/96960759-a39a-42c4-9b69-62b9597f1522",
            "sourceStep": "\/api\/3\/workflow_steps\/3aca9a33-ed5c-4d02-ba7c-dd6f7ea0e6d6",
            "label": "No",
            "isExecuted": false,
            "group": null,
            "uuid": "54dc02d6-0004-423f-afbd-babd39a2527f"
        },
        {
            "@type": "WorkflowRoute",
            "name": "override_stepmap -> request_metafield_input",
            "targetStep": "\/api\/3\/workflow_steps\/1a8f227a-c1f2-4f5c-b28b-f64be928924e",
            "sourceStep": "\/api\/3\/workflow_steps\/5d2687f5-6e57-4e52-a888-e3a5e94cf47e",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "0783594c-a2e6-42f2-8983-d81f29b35299"
        },
        {
            "@type": "WorkflowRoute",
            "name": "request_metafield_input -> synch_fmg_meta",
            "targetStep": "\/api\/3\/workflow_steps\/6cfffd94-31c1-44de-b7d8-1750735d2cf8",
            "sourceStep": "\/api\/3\/workflow_steps\/1a8f227a-c1f2-4f5c-b28b-f64be928924e",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "cf7c5784-ccd0-4d39-8d6b-70e0b407da7b"
        },
        {
            "@type": "WorkflowRoute",
            "name": "retrieve_config_vars -> retrieve_device_config",
            "targetStep": "\/api\/3\/workflow_steps\/4a81852a-49d6-4cdf-bf6c-1ece6c19078c",
            "sourceStep": "\/api\/3\/workflow_steps\/78ee3def-48f3-4126-8817-0cf99b9ca42f",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "e51d7d84-2848-4a62-bdf4-6fea2bbc0d35"
        },
        {
            "@type": "WorkflowRoute",
            "name": "retrieve_device_config -> ztp_phase_complete_vars",
            "targetStep": "\/api\/3\/workflow_steps\/96960759-a39a-42c4-9b69-62b9597f1522",
            "sourceStep": "\/api\/3\/workflow_steps\/4a81852a-49d6-4cdf-bf6c-1ece6c19078c",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "eac50c77-f021-478f-8ad4-ec1d62112098"
        },
        {
            "@type": "WorkflowRoute",
            "name": "run_device_group -> ztp_phase_complete_vars",
            "targetStep": "\/api\/3\/workflow_steps\/96960759-a39a-42c4-9b69-62b9597f1522",
            "sourceStep": "\/api\/3\/workflow_steps\/e833980d-c02b-48cb-b7b5-9251e255a5e6",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "20eeef03-268f-44e0-9de2-41cb0c656bc1"
        },
        {
            "@type": "WorkflowRoute",
            "name": "run_install_device_config -> ztp_phase_complete_vars",
            "targetStep": "\/api\/3\/workflow_steps\/96960759-a39a-42c4-9b69-62b9597f1522",
            "sourceStep": "\/api\/3\/workflow_steps\/93c21c3a-d15f-493e-bc0c-96bd547f8b95",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "5bdff83a-9a1f-48fa-813a-950bc5de8ada"
        },
        {
            "@type": "WorkflowRoute",
            "name": "run_install_policy_pkg -> ztp_phase_complete_vars",
            "targetStep": "\/api\/3\/workflow_steps\/96960759-a39a-42c4-9b69-62b9597f1522",
            "sourceStep": "\/api\/3\/workflow_steps\/32017c43-86e5-483d-8df5-df6416c2c06a",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "a810959b-b3e1-43f0-8902-bd0b3bdc4df4"
        },
        {
            "@type": "WorkflowRoute",
            "name": "run_linked_scripts_vars -> run linked scripts",
            "targetStep": "\/api\/3\/workflow_steps\/eacd0ca0-f11f-458f-8465-7eda07222054",
            "sourceStep": "\/api\/3\/workflow_steps\/0ecd9d9f-3be8-4fa7-9738-e181666aedbd",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "8de956b0-513d-4f2a-97de-3713fea2b48f"
        },
        {
            "@type": "WorkflowRoute",
            "name": "run linked scripts -> ztp_phase_complete_vars",
            "targetStep": "\/api\/3\/workflow_steps\/96960759-a39a-42c4-9b69-62b9597f1522",
            "sourceStep": "\/api\/3\/workflow_steps\/eacd0ca0-f11f-458f-8465-7eda07222054",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "0aaa4993-ec6c-4d48-87f9-25a97ff885c2"
        },
        {
            "@type": "WorkflowRoute",
            "name": "set_initial_vars -> create_ztp_steps",
            "targetStep": "\/api\/3\/workflow_steps\/2532f825-69f6-4435-9d54-7401d051369a",
            "sourceStep": "\/api\/3\/workflow_steps\/5914a5bf-43b4-43b9-a98f-cb57a79181bb",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "0ddf0821-5260-4233-9f45-7276b12f3f07"
        },
        {
            "@type": "WorkflowRoute",
            "name": "set_monitor_step -> ztp_phase_complete_vars",
            "targetStep": "\/api\/3\/workflow_steps\/96960759-a39a-42c4-9b69-62b9597f1522",
            "sourceStep": "\/api\/3\/workflow_steps\/5c776ca2-20f2-478c-b0c1-c713b7610fb8",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "c6b534f2-2086-4a98-9135-04c5b630071c"
        },
        {
            "@type": "WorkflowRoute",
            "name": "Start -> set_initial_vars",
            "targetStep": "\/api\/3\/workflow_steps\/5914a5bf-43b4-43b9-a98f-cb57a79181bb",
            "sourceStep": "\/api\/3\/workflow_steps\/1e06b8ec-5e9c-49c1-94fa-a4c2b0f413d2",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "b56ccdaa-aec2-499b-b2d0-4c4e00e9a5d7"
        },
        {
            "@type": "WorkflowRoute",
            "name": "synch_device_db_device -> ztp_phase_complete",
            "targetStep": "\/api\/3\/workflow_steps\/da90c418-fff8-473f-8974-323acfcc4f7b",
            "sourceStep": "\/api\/3\/workflow_steps\/03b25d7a-fa43-44cf-af4b-76528131fa7f",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "b10d6020-4bff-4bc4-93ac-d0f980bbfb8d"
        },
        {
            "@type": "WorkflowRoute",
            "name": "synch_fmg_meta -> metadata_monitor",
            "targetStep": "\/api\/3\/workflow_steps\/f697e400-e6a0-4a78-8268-7e71d12bd58a",
            "sourceStep": "\/api\/3\/workflow_steps\/6cfffd94-31c1-44de-b7d8-1750735d2cf8",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "27a0a1c0-d92f-42ce-9e01-f4da92438267"
        },
        {
            "@type": "WorkflowRoute",
            "name": "ztp_phase -> auth_vars",
            "targetStep": "\/api\/3\/workflow_steps\/0bdbfd0c-e143-4a75-b69d-40e168adb59a",
            "sourceStep": "\/api\/3\/workflow_steps\/898a754f-6d8a-401e-8958-6c8bf5540e34",
            "label": "Authorize",
            "isExecuted": false,
            "group": null,
            "uuid": "a7cebfaa-95b1-4b1a-8556-aecb93e52e39"
        },
        {
            "@type": "WorkflowRoute",
            "name": "ztp_phase_complete -> update_next_step",
            "targetStep": "\/api\/3\/workflow_steps\/be43c13b-61d0-4ca8-bf64-164288ff45e9",
            "sourceStep": "\/api\/3\/workflow_steps\/da90c418-fff8-473f-8974-323acfcc4f7b",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "e45e9e16-5e5f-4974-9fe4-c5cff2d5d549"
        },
        {
            "@type": "WorkflowRoute",
            "name": "ztp_phase_complete_vars -> synch_device_db_device",
            "targetStep": "\/api\/3\/workflow_steps\/03b25d7a-fa43-44cf-af4b-76528131fa7f",
            "sourceStep": "\/api\/3\/workflow_steps\/96960759-a39a-42c4-9b69-62b9597f1522",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "2b54f7f3-82f3-4aaa-9606-7a9c062263b2"
        },
        {
            "@type": "WorkflowRoute",
            "name": "ztp_phase -> device_groups_vars",
            "targetStep": "\/api\/3\/workflow_steps\/d3f1570c-ce44-4cc7-b7ad-f63fc7d42290",
            "sourceStep": "\/api\/3\/workflow_steps\/898a754f-6d8a-401e-8958-6c8bf5540e34",
            "label": "Device Groups",
            "isExecuted": false,
            "group": null,
            "uuid": "5282ea97-a058-4851-b620-e3f02f0dd52c"
        },
        {
            "@type": "WorkflowRoute",
            "name": "ztp_phase -> install_config_devices",
            "targetStep": "\/api\/3\/workflow_steps\/d0c4efd4-e7d1-4547-80be-1f97e3eea339",
            "sourceStep": "\/api\/3\/workflow_steps\/898a754f-6d8a-401e-8958-6c8bf5540e34",
            "label": "Install Device Config",
            "isExecuted": false,
            "group": null,
            "uuid": "5eed2313-7f05-40d9-9a93-c4b787325b21"
        },
        {
            "@type": "WorkflowRoute",
            "name": "ztp_phase -> install_policy_vars",
            "targetStep": "\/api\/3\/workflow_steps\/e862d677-59bf-4787-bde7-12adf75fe030",
            "sourceStep": "\/api\/3\/workflow_steps\/898a754f-6d8a-401e-8958-6c8bf5540e34",
            "label": "Install Policy Package",
            "isExecuted": false,
            "group": null,
            "uuid": "a16f96e3-e54a-4767-9866-bd92de935d97"
        },
        {
            "@type": "WorkflowRoute",
            "name": "ztp_phase -> metadata_vars",
            "targetStep": "\/api\/3\/workflow_steps\/6163c3b1-6f5b-4ab4-a907-38b25fbc9eb6",
            "sourceStep": "\/api\/3\/workflow_steps\/898a754f-6d8a-401e-8958-6c8bf5540e34",
            "label": "Device Metadata",
            "isExecuted": false,
            "group": null,
            "uuid": "6699ed36-1839-4277-b23f-cf9226aa988d"
        },
        {
            "@type": "WorkflowRoute",
            "name": "ztp_phase -> retrieve_config_vars",
            "targetStep": "\/api\/3\/workflow_steps\/78ee3def-48f3-4126-8817-0cf99b9ca42f",
            "sourceStep": "\/api\/3\/workflow_steps\/898a754f-6d8a-401e-8958-6c8bf5540e34",
            "label": "Retrieve Device Config",
            "isExecuted": false,
            "group": null,
            "uuid": "639bb71c-939f-4014-a5c4-f2a75ee026be"
        },
        {
            "@type": "WorkflowRoute",
            "name": "ztp_phase -> run_linked_scripts_vars",
            "targetStep": "\/api\/3\/workflow_steps\/0ecd9d9f-3be8-4fa7-9738-e181666aedbd",
            "sourceStep": "\/api\/3\/workflow_steps\/898a754f-6d8a-401e-8958-6c8bf5540e34",
            "label": "Run Linked Scripts",
            "isExecuted": false,
            "group": null,
            "uuid": "13b6d734-bb63-484c-b36c-9f04397014d8"
        },
        {
            "@type": "WorkflowRoute",
            "name": "ztp_phase_started -> ztp_phase",
            "targetStep": "\/api\/3\/workflow_steps\/898a754f-6d8a-401e-8958-6c8bf5540e34",
            "sourceStep": "\/api\/3\/workflow_steps\/581d6f7a-6f54-4fed-a9a1-fe1b2534c664",
            "label": null,
            "isExecuted": false,
            "group": null,
            "uuid": "215353f8-8171-4046-b318-c4bad8afb737"
        },
        {
            "@type": "WorkflowRoute",
            "name": "ztp_phase -> ztp_phase_skipped",
            "targetStep": "\/api\/3\/workflow_steps\/25aea552-966b-4df8-b13c-078cc1174d9d",
            "sourceStep": "\/api\/3\/workflow_steps\/898a754f-6d8a-401e-8958-6c8bf5540e34",
            "label": "Not Supported",
            "isExecuted": false,
            "group": null,
            "uuid": "89bccc58-08f4-4f37-97e8-01068ad8b4d7"
        }
    ],
    "groups": [],
    "priority": "\/api\/3\/picklists\/2b563c61-ae2c-41c0-a85a-c9709585e3f2",
    "uuid": "8fdcdcb0-0511-401a-9485-3b61ccfc8cc4",
    "owners": [],
    "isPrivate": false,
    "deletedAt": null,
    "recordTags": [
        "system",
        "Trigger",
        "Devices",
        "Run Linked Scripts"
    ]
}